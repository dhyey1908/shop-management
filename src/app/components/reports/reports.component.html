<div class="reports-container" [class.no-print]="selectedInvoice">
    <div class="page-header no-print">
        <button class="btn btn-secondary" (click)="goBack()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                stroke="currentColor" style="width: 20px; height: 20px;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            {{ 'BACK' | translate }}
        </button>
        <h2>{{ 'REPORTS' | translate }}</h2>
        <div></div>
    </div>

    <div class="card">
        <div class="filter-section no-print">
            <div class="date-range">
                <div class="form-group">
                    <label class="form-label">{{ 'START_DATE' | translate }}</label>
                    <input type="date" class="form-control" [(ngModel)]="startDate">
                </div>
                <span class="form-group date-separator">{{ 'TO' | translate }}</span>
                <div class="form-group">
                    <label class="form-label">{{ 'END_DATE' | translate }}</label>
                    <input type="date" class="form-control" [(ngModel)]="endDate">
                </div>
                <button class="form-group btn btn-primary" (click)="generateReport()">{{ 'GENERATE' | translate
                    }}</button>
            </div>
        </div>

        <div *ngIf="report" class="report-content">
            <div class="report-header">
                <h3>{{ 'SALES_REPORT' | translate }}</h3>
                <p class="report-period">{{ formatDate(report.startDate) }} - {{ formatDate(report.endDate) }}</p>
            </div>

            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-icon sales">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h4>{{ 'TOTAL_SALES' | translate }}</h4>
                        <p class="stat-value">{{ formatCurrency(report.totalSales) }}</p>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-icon invoices">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h4>{{ 'TOTAL_INVOICES' | translate }}</h4>
                        <p class="stat-value">{{ report.totalInvoices }}</p>
                    </div>
                </div>

                <div class="stat-box">
                    <div class="stat-icon product">
                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                            stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round"
                                d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0" />
                        </svg>
                    </div>
                    <div class="stat-info">
                        <h4>{{ 'TOP_PRODUCT' | translate }}</h4>
                        <p class="stat-value top-product">{{ report.topProduct || ('N_A' | translate) }}</p>
                    </div>
                </div>
            </div>

            <div class="export-actions no-print">
                <button class="btn btn-secondary" (click)="printReport()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" style="width: 20px; height: 20px;">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z" />
                    </svg>
                    {{ 'DOWNLOAD_PDF' | translate }}
                </button>
                <button class="btn btn-primary" (click)="exportJSON()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" style="width: 20px; height: 20px;">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                    </svg>
                    {{ 'EXPORT_JSON' | translate }}
                </button>
            </div>

            <div class="invoices-section" *ngIf="report.invoices.length > 0">
                <h4>{{ 'INVOICE_DETAILS' | translate }}</h4>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>{{ 'INVOICE_NO' | translate }}</th>
                                <th>{{ 'CUSTOMER' | translate }}</th>
                                <th>{{ 'DATE' | translate }}</th>
                                <th>{{ 'ITEMS' | translate }}</th>
                                <th>{{ 'AMOUNT' | translate }}</th>
                                <th class="no-print">{{ 'ACTIONS' | translate }}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let invoice of report.invoices">
                                <td><strong>#{{ invoice.invoiceNumber }}</strong></td>
                                <td>{{ invoice.customerName }}</td>
                                <td>{{ formatDate(invoice.date) }}</td>
                                <td>{{ invoice.items.length }}</td>
                                <td><strong>{{ formatCurrency(invoice.grandTotal) }}</strong></td>
                                <td class="no-print">
                                    <button class="btn btn-sm btn-primary" (click)="viewInvoice(invoice)">{{ 'VIEW' |
                                        translate }}</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div *ngIf="report.invoices.length === 0" class="empty-state">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z" />
                </svg>
                <p>{{ 'NO_INVOICES_PERIOD' | translate }}</p>
            </div>
        </div>
    </div>
</div>

<!-- Invoice Detail Modal -->
<div class="modal-overlay" *ngIf="selectedInvoice" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header no-print">
            <h3>{{ 'INVOICE_DETAILS' | translate }}</h3>
            <button class="btn-close" (click)="closeModal()">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>

        <div class="invoice-detail">
            <div class="invoice-header-info">
                <div>
                    <h4>Invoice #{{ selectedInvoice.invoiceNumber }}</h4>
                    <p class="text-muted">{{ formatDate(selectedInvoice.date) }}</p>
                </div>
                <div class="customer-info">
                    <h4>{{ 'CUSTOMER' | translate }}</h4>
                    <p>{{ selectedInvoice.customerName }}</p>
                </div>
            </div>

            <div class="invoice-items">
                <h4>{{ 'ITEMS' | translate }}</h4>
                <table>
                    <thead>
                        <tr>
                            <th>{{ 'PRODUCT_NAME' | translate }}</th>
                            <th>{{ 'QTY' | translate }}</th>
                            <th>{{ 'PRICE' | translate }}</th>
                            <th>{{ 'TOTAL' | translate }}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr *ngFor="let item of selectedInvoice.items">
                            <td>{{ item.productName }}</td>
                            <td>{{ item.quantity }}</td>
                            <td>{{ formatCurrency(item.price) }}</td>
                            <td>{{ formatCurrency(item.total) }}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="invoice-totals">
                <div class="total-row">
                    <span>{{ 'SUBTOTAL' | translate }}:</span>
                    <span>{{ formatCurrency(selectedInvoice.subtotal) }}</span>
                </div>
                <div class="total-row" *ngIf="selectedInvoice.discount > 0">
                    <span>{{ 'DISCOUNT' | translate }} ({{ selectedInvoice.discountType === 'percentage' ?
                        selectedInvoice.discountValue +
                        '%' : ('FIXED' | translate) }}):</span>
                    <span>- {{ formatCurrency(selectedInvoice.discount) }}</span>
                </div>
                <div class="total-row grand-total">
                    <span>{{ 'GRAND_TOTAL' | translate }}:</span>
                    <span>{{ formatCurrency(selectedInvoice.grandTotal) }}</span>
                </div>
            </div>

            <div class="modal-actions no-print">
                <button class="btn btn-secondary" (click)="closeModal()">{{ 'CLOSE' | translate }}</button>
                <button class="btn btn-primary" (click)="printReport()">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                        stroke="currentColor" style="width: 20px; height: 20px;">
                        <path stroke-linecap="round" stroke-linejoin="round"
                            d="M6.72 13.829c-.24.03-.48.062-.72.096m.72-.096a42.415 42.415 0 0110.56 0m-10.56 0L6.34 18m10.94-4.171c.24.03.48.062.72.096m-.72-.096L17.66 18m0 0l.229 2.523a1.125 1.125 0 01-1.12 1.227H7.231c-.662 0-1.18-.568-1.12-1.227L6.34 18m11.318 0h1.091A2.25 2.25 0 0021 15.75V9.456c0-1.081-.768-2.015-1.837-2.175a48.055 48.055 0 00-1.913-.247M6.34 18H5.25A2.25 2.25 0 013 15.75V9.456c0-1.081.768-2.015 1.837-2.175a48.041 48.041 0 011.913-.247m10.5 0a48.536 48.536 0 00-10.5 0m10.5 0V3.375c0-.621-.504-1.125-1.125-1.125h-8.25c-.621 0-1.125.504-1.125 1.125v3.659M18 10.5h.008v.008H18V10.5zm-3 0h.008v.008H15V10.5z" />
                    </svg>
                    {{ 'PRINT' | translate }}
                </button>
            </div>
        </div>
    </div>
</div>