<!-- Interactive Billing Screen -->
<div class="billing-container no-print">
    <div class="billing-header">
        <button class="btn btn-secondary back-btn" (click)="goBack()">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                stroke="currentColor" style="width: 20px; height: 20px;">
                <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5L3 12m0 0l7.5-7.5M3 12h18" />
            </svg>
            {{ 'BACK' | translate }}
        </button>
        <h2>{{ 'NEW_INVOICE_TITLE' | translate }}</h2>
        <div style="width: 80px"></div>
    </div>

    <div class="card">
        <!-- Header: Customer and Date -->
        <div class="invoice-header-row">
            <div class="form-group customer-group">
                <label>{{ 'CUSTOMER_NAME' | translate }}:</label>
                <div class="d-flex gap-2">
                    <app-searchable-dropdown [options]="customerOptions" [placeholder]="'SELECT_CUSTOMER' | translate"
                        [(ngModel)]="selectedCustomerId" (selectionChange)="onCustomerSelect($event)" style="flex: 1">
                    </app-searchable-dropdown>

                </div>
            </div>
            <div>
                <button class="btn btn-primary btn-icon" (click)="goToAddCustomer()" title="Add New Customer">
                    +
                </button>
            </div>
            <div class="form-group date-group">
                <label>{{ 'DATE' | translate }}:</label>
                <input type="date" class="form-control" [(ngModel)]="date">
            </div>
        </div>

        <!-- Table -->
        <div class="items-table-container">
            <table class="items-table">
                <thead>
                    <tr>
                        <th style="width: 40%">{{ 'ITEM_NAME' | translate }}</th>
                        <th style="width: 15%">{{ 'QUANTITY' | translate }}</th>
                        <th style="width: 20%">{{ 'PRICE' | translate }}</th>
                        <th style="width: 20%">{{ 'TOTAL' | translate }}</th>
                        <th style="width: 5%"></th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let item of items; let i = index">
                        <td>
                            <app-searchable-dropdown [options]="productOptions"
                                [placeholder]="'SELECT_PRODUCT' | translate" [(ngModel)]="item.productId"
                                (selectionChange)="onProductSelect(i, $event)">
                            </app-searchable-dropdown>
                        </td>
                        <td>
                            <input type="number" class="form-control text-center" [(ngModel)]="item.quantity"
                                (change)="updateQuantity(i, item.quantity)" min="1">
                        </td>
                        <td>
                            <input type="number" class="form-control text-right" [(ngModel)]="item.price"
                                (change)="updatePrice(i, item.price)" min="0">
                        </td>
                        <td class="text-right total-cell">
                            {{ formatCurrency(item.total) }}
                        </td>
                        <td class="text-center">
                            <button class="btn-icon btn-danger btn-sm" (click)="removeItem(i)"
                                *ngIf="items.length > 1 || item.productId" title="Remove Item">
                                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2"
                                    stroke="currentColor" style="width: 16px; height: 16px;">
                                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <div class="add-item-row">
                <button class="btn btn-link" (click)="addNewItemRow()">
                    + {{ 'ADD_ITEM' | translate }}
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="invoice-footer">
            <div class="totals-container">
                <div class="total-row">
                    <label>{{ 'SUBTOTAL' | translate }}:</label>
                    <span class="value">{{ formatCurrency(subtotal) }}</span>
                </div>
                <div class="total-row">
                    <label>{{ 'DISCOUNT' | translate }}:</label>
                    <div class="discount-input-group">
                        <span> % </span>
                        <input type="number" [(ngModel)]="discountPercentage" (ngModelChange)="onDiscountChange()"
                            min="0" max="100">
                    </div>
                </div>
                <div class="separator"></div>
                <div class="total-row grand-total-row">
                    <label>{{ 'GRAND_TOTAL' | translate }}:</label>
                    <span class="value">{{ formatCurrency(grandTotal) }}</span>
                </div>

                <div class="total-row"
                    style="margin-top: 10px; display: flex; align-items: center; justify-content: flex-end; gap: 10px;">
                    <label style="margin: 0;">{{ 'STATUS' | translate }}:</label>
                    <div class="btn-group">
                        <button type="button" class="btn btn-sm" [class.btn-success]="paymentStatus === 'Paid'"
                            [class.btn-outline-secondary]="paymentStatus !== 'Paid'" (click)="paymentStatus = 'Paid'">{{
                            'PAID' | translate }}</button>
                        <button type="button" class="btn btn-sm" [class.btn-warning]="paymentStatus === 'Pending'"
                            [class.btn-outline-secondary]="paymentStatus !== 'Pending'"
                            (click)="paymentStatus = 'Pending'">{{ 'PENDING' | translate }}</button>
                    </div>
                </div>
                <div class="separator"></div>
            </div>
        </div>

        <!-- Actions -->
        <div class="actions-bar">
            <button class="btn btn-primary" (click)="saveInvoice()"> {{ 'SAVE_INVOICE' | translate }}</button>
            <button class="btn btn-secondary" (click)="printInvoice()" (click)="saveInvoice()"> {{ 'PRINT' | translate
                }}</button>
            <button class="btn btn-outline" (click)="clearForm()"> {{ 'CLEAR' | translate }}</button>
        </div>
    </div>
</div>

<!-- Print Receipt Template -->
<div class="print-template print-only">
    <div class="print-invoice" id="printInvoice">
        <!-- Header with Shop Name and Mobile -->
        <div class="print-header-box">
            <div class="shop-title">{{ shopName || 'SHOP NAME HERE' }}</div>
            <div class="shop-mobile" *ngIf="shopPhone">{{ shopPhone }}</div>
        </div>

        <!-- Customer and Date Row -->
        <div class="customer-date-row">
            <div class="customer-info">
                <span class="label">{{ 'CUSTOMER_NAME' | translate }}:</span>
                <span class="value">{{ customerName || 'Walk-in Customer' }}</span>
            </div>
            <div class="date-info">
                <span class="label">{{ 'DATE' | translate }}:</span>
                <span class="value">{{ formatDate(date) }}</span>
            </div>
        </div>

        <!-- Items Table with Borders -->
        <table class="print-table-bordered">
            <thead>
                <tr>
                    <th class="col-sr">{{ 'SR_NO' | translate }}</th>
                    <th class="col-item">{{ 'ITEM_NAME' | translate }}</th>
                    <th class="col-qty">{{ 'QUANTITY' | translate }}</th>
                    <th class="col-price">{{ 'PRICE' | translate }}</th>
                    <th class="col-total">{{ 'TOTAL' | translate }}</th>
                </tr>
            </thead>
            <tbody>
                <ng-container *ngFor="let item of items; let i = index">
                    <tr *ngIf="item.productName">
                        <td class="col-sr">{{ i + 1 }}</td>
                        <td class="col-item">{{ item.productName }}</td>
                        <td class="col-qty">{{ item.quantity }}</td>
                        <td class="col-price">{{ item.price }}</td>
                        <td class="col-total">{{ formatCurrency(item.total) }}</td>
                    </tr>
                </ng-container>
                <!-- Empty rows to maintain structure (minimum 5 rows) -->
                <ng-container *ngFor="let emptyRow of getEmptyRows()">
                    <tr class="empty-row">
                        <td class="col-sr">&nbsp;</td>
                        <td class="col-item">&nbsp;</td>
                        <td class="col-qty">&nbsp;</td>
                        <td class="col-price">&nbsp;</td>
                        <td class="col-total">&nbsp;</td>
                    </tr>
                </ng-container>
            </tbody>
        </table>

        <!-- Totals Section -->
        <div class="totals-section">
            <div class="total-row">
                <span class="total-label">{{ 'TOTAL_ITEMS' | translate }}:</span>
                <span class="total-value">{{ getTotalItemCount() }}</span>
            </div>
            <div class="total-row">
                <span class="total-label">{{ 'SUBTOTAL' | translate }}:</span>
                <span class="total-value">{{ formatCurrency(subtotal) }}</span>
            </div>
            <div class="total-row" *ngIf="discountAmount > 0">
                <span class="total-label">{{ 'DISCOUNT' | translate }} ({{ discountPercentage }}% / ₹):</span>
                <span class="total-value">{{ formatCurrency(discountAmount) }}</span>
            </div>
            <div class="total-row">
                <span class="total-label">{{ 'TAX_GST' | translate }}:</span>
                <span class="total-value">₹ 0.00</span>
            </div>
        </div>

        <!-- Grand Total -->
        <div class="grand-total-section">
            <div class="grand-total-row">
                <span class="grand-total-label">{{ 'GRAND_TOTAL' | translate }}:</span>
                <span class="grand-total-value">{{ formatCurrency(grandTotal) }}</span>
            </div>
        </div>

        <!-- Thank You Message -->
        <div class="thank-you-section">
            <p>{{ 'VISIT_AGAIN' | translate }}</p>
        </div>
    </div>
</div>